<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>TÃ¬m kiáº¿m Ä‘Äƒng kÃ½</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-5">
  <h2 class="mb-4 text-primary">ğŸ” TÃ¬m kiáº¿m Ä‘Äƒng kÃ½ theo khoáº£ng thá»i gian</h2>

  <!-- FORM TÃŒM KIáº¾M -->
  <form id="searchForm" class="row g-3 mb-4" novalidate>
    <div class="col-md-5">
      <label for="startDate" class="form-label">NgÃ y báº¯t Ä‘áº§u</label>
      <input type="date" id="startDate" name="start" class="form-control" required>
    </div>
    <div class="col-md-5">
      <label for="endDate" class="form-label">NgÃ y káº¿t thÃºc</label>
      <input type="date" id="endDate" name="end" class="form-control" required>
    </div>
    <div class="col-md-2 d-flex align-items-end">
      <button type="submit" class="btn btn-success w-100">TÃ¬m</button>
    </div>
  </form>

  <!-- Káº¾T QUáº¢ -->
  <div id="resultArea"></div>

  <!-- SCRIPT -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const form = document.getElementById('searchForm');
      const resultArea = document.getElementById('resultArea');

      form.addEventListener('submit', async function (e) {
        e.preventDefault();

        const start = document.getElementById('startDate').value;
        const end = document.getElementById('endDate').value;

        if (!start || !end || new Date(start) > new Date(end)) {
          return alert('Vui lÃ²ng chá»n khoáº£ng ngÃ y há»£p lá»‡!');
        }

        const token = localStorage.getItem('token');
        if (!token) {
          return alert('Báº¡n chÆ°a Ä‘Äƒng nháº­p!');
        }

        try {
          const res = await fetch(`/api/registration/getRegistrationsByDate?start=${start}&end=${end}`, {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });

          const data = await res.json();

          if (!res.ok) {
            return resultArea.innerHTML = `<div class="alert alert-danger">${data.error || 'Lá»—i khÃ´ng xÃ¡c Ä‘á»‹nh'}</div>`;
          }

          if (!data.data || data.data.length === 0) {
            return resultArea.innerHTML = `<div class="alert alert-warning">KhÃ´ng cÃ³ Ä‘Äƒng kÃ½ nÃ o trong khoáº£ng thá»i gian nÃ y.</div>`;
          }

          // Render báº£ng káº¿t quáº£
          let html = `
            <table class="table table-bordered table-striped mt-4">
              <thead class="table-light">
                <tr>
                  <th>#</th>
                  <th>Sá»‘ Ä‘iá»‡n thoáº¡i SV</th>
                  <th>TÃªn sá»± kiá»‡n</th>
                  <th>NgÃ y tá»• chá»©c</th>
                  <th>NgÃ y Ä‘Äƒng kÃ½</th>
                </tr>
              </thead>
              <tbody>
          `;

          data.data.forEach((reg, index) => {
            html += `
              <tr>
                <td>${index + 1}</td>
                <td>${reg.studentId?.phone || 'N/A'}</td>
                <td>${reg.eventId?.name || 'N/A'}</td>
                <td>${new Date(reg.eventId?.date).toLocaleDateString()}</td>
                <td>${new Date(reg.registrationDate).toLocaleString()}</td>
              </tr>
            `;
          });

          html += '</tbody></table>';
          resultArea.innerHTML = html;

        } catch (err) {
          console.error(err);
          resultArea.innerHTML = `<div class="alert alert-danger">Lá»—i mÃ¡y chá»§!</div>`;
        }
      });
    });
  </script>
</body>
</html>
